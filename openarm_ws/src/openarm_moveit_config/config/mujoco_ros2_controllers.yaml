controller_manager:
  ros__parameters:
    update_rate: 100  # 建议：力控模式下提高频率到 1000Hz (1ms 周期)

    left_arm_controller:
      type: joint_trajectory_controller/JointTrajectoryController

    right_arm_controller:
      type: joint_trajectory_controller/JointTrajectoryController

    left_hand_controller:
      # 修正：通常是 gripper_controllers 而不是 position_controllers
      type: gripper_controllers/GripperActionController

    right_hand_controller:
      type: gripper_controllers/GripperActionController

    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

left_arm_controller:
  ros__parameters:
    joints:
      - openarm_left_joint1
      - openarm_left_joint2
      - openarm_left_joint3
      - openarm_left_joint4
      - openarm_left_joint5
      - openarm_left_joint6
      - openarm_left_joint7
    command_interfaces:
      - effort
    state_interfaces:
      - position
      - velocity
    
    # 【重要新增】因为使用了 effort 接口，必须配置 PID
    # 注意：这里的 p, i, d 值需要根据你的真实硬件进行调试
    gains:
      openarm_left_joint1: {p: 100.0, i: 1.0, d: 10.0, ff_velocity_scale: 1.0}
      openarm_left_joint2: {p: 100.0, i: 1.0, d: 10.0, ff_velocity_scale: 1.0}
      openarm_left_joint3: {p: 100.0, i: 1.0, d: 10.0, ff_velocity_scale: 1.0}
      openarm_left_joint4: {p: 80.0, i: 0.5, d: 5.0, ff_velocity_scale: 1.0}
      openarm_left_joint5: {p: 50.0, i: 0.1, d: 1.0, ff_velocity_scale: 1.0}
      openarm_left_joint6: {p: 50.0, i: 0.1, d: 1.0, ff_velocity_scale: 1.0}
      openarm_left_joint7: {p: 20.0, i: 0.0, d: 0.5, ff_velocity_scale: 1.0}

    # 建议：防止运动规划因为稍微的误差而中止
    constraints:
      goal_time: 0.6
      stopped_velocity_tolerance: 0.05
      openarm_left_joint1: {trajectory: 0.1, goal: 0.1}
      openarm_left_joint2: {trajectory: 0.1, goal: 0.1}
      openarm_left_joint3: {trajectory: 0.1, goal: 0.1}
      openarm_left_joint4: {trajectory: 0.1, goal: 0.1}
      openarm_left_joint5: {trajectory: 0.1, goal: 0.1}
      openarm_left_joint6: {trajectory: 0.1, goal: 0.1}
      openarm_left_joint7: {trajectory: 0.1, goal: 0.1}

right_arm_controller:
  ros__parameters:
    joints:
      - openarm_right_joint1
      - openarm_right_joint2
      - openarm_right_joint3
      - openarm_right_joint4
      - openarm_right_joint5
      - openarm_right_joint6
      - openarm_right_joint7
    command_interfaces:
      - effort
    state_interfaces:
      - position
      - velocity
    
    # 【重要新增】右手 PID
    gains:
      openarm_right_joint1: {p: 100.0, i: 1.0, d: 10.0, ff_velocity_scale: 1.0}
      openarm_right_joint2: {p: 100.0, i: 1.0, d: 10.0, ff_velocity_scale: 1.0}
      openarm_right_joint3: {p: 100.0, i: 1.0, d: 10.0, ff_velocity_scale: 1.0}
      openarm_right_joint4: {p: 80.0, i: 0.5, d: 5.0, ff_velocity_scale: 1.0}
      openarm_right_joint5: {p: 50.0, i: 0.1, d: 1.0, ff_velocity_scale: 1.0}
      openarm_right_joint6: {p: 50.0, i: 0.1, d: 1.0, ff_velocity_scale: 1.0}
      openarm_right_joint7: {p: 20.0, i: 0.0, d: 0.5, ff_velocity_scale: 1.0}

    # 建议：防止运动规划因为稍微的误差而中止
    constraints:
      goal_time: 0.6
      stopped_velocity_tolerance: 0.05
      openarm_right_joint1: {trajectory: 0.1, goal: 0.1}
      openarm_right_joint2: {trajectory: 0.1, goal: 0.1}
      openarm_right_joint3: {trajectory: 0.1, goal: 0.1}
      openarm_right_joint4: {trajectory: 0.1, goal: 0.1}
      openarm_right_joint5: {trajectory: 0.1, goal: 0.1}
      openarm_right_joint6: {trajectory: 0.1, goal: 0.1}
      openarm_right_joint7: {trajectory: 0.1, goal: 0.1}

left_hand_controller:
  ros__parameters:
    joint: openarm_left_finger_joint1
    # 允许 Action 接受位置指令
    allow_stalled_at_goal: true 
    goal_tolerance: 0.05  #稍微改小一点，看实际精度
    stalled_velocity_threshold: 0.01
    stall_timeout: 0.5

right_hand_controller:
  ros__parameters:
    joint: openarm_right_finger_joint1
    allow_stalled_at_goal: true
    goal_tolerance: 0.05
    stalled_velocity_threshold: 0.01
    stall_timeout: 0.5